<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Kale: Creating &amp; Setting up a Scene</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="kale.png"/></td>
  <td id="projectalign">
   <div id="projectname">Kale
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Creating &amp; Setting up a Scene </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="sceneSetup"></a></p>
<h1><a class="anchor" id="scenesetup_s1"></a>
Creating a Scene</h1>
<p >To create a scene you need to inherit from the <a class="el" href="class_kale_1_1_scene.html">Scene</a> class. A basic implementation consists of the following:</p>
<div class="fragment"><div class="line"><span class="comment">// TestScene.hpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_core_2_core_8hpp.html">Kale/Core/Core.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_engine_8hpp.html">Kale/Engine/Engine.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>KaleTesting {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">class </span>TestScene : <span class="keyword">public</span> <a class="code hl_class" href="class_kale_1_1_scene.html">Kale::Scene</a> {</div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">protected</span>:</div>
<div class="line">        <span class="keywordtype">void</span> onPresent() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="a_core_2_core_8hpp_html"><div class="ttname"><a href="_core_2_core_8hpp.html">Core.hpp</a></div></div>
<div class="ttc" id="a_engine_8hpp_html"><div class="ttname"><a href="_engine_8hpp.html">Engine.hpp</a></div></div>
<div class="ttc" id="aclass_kale_1_1_scene_html"><div class="ttname"><a href="class_kale_1_1_scene.html">Kale::Scene</a></div><div class="ttdef"><b>Definition:</b> <a href="_scene_8hpp_source.html#l00037">Scene.hpp:37</a></div></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// TestScene.cpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;TestScene.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>KaleTesting;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> TestScene::onPresent() {</div>
<div class="line">    Scene::onPresent();</div>
<div class="line">    <a class="code hl_define" href="_logger_8hpp.html#adc4de02b0b410c356e870d11ca06bf5f">klPrint</a>(<span class="stringliteral">&quot;Hello World!&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="a_logger_8hpp_html_adc4de02b0b410c356e870d11ca06bf5f"><div class="ttname"><a href="_logger_8hpp.html#adc4de02b0b410c356e870d11ca06bf5f">klPrint</a></div><div class="ttdeci">#define klPrint(x)</div><div class="ttdef"><b>Definition:</b> <a href="_logger_8hpp_source.html#l00332">Logger.hpp:332</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="scenesetup_s2"></a>
Scene Events</h1>
<p >The <a class="el" href="class_kale_1_1_scene.html">Scene</a> class inherits from the <a class="el" href="class_kale_1_1_event_handler.html">EventHandler</a> class and listens to events when presented. You can override any EventHandler events directly in your scene class.</p>
<blockquote class="doxtable">
<p >&zwj;<b>NOTE</b> - If you override the <a class="el" href="class_kale_1_1_event_handler.html#a068a1ce78a787bc6a2229f20860e2892">EventHandler</a> event, make sure you call the <a class="el" href="class_kale_1_1_scene.html#acb97f9c14a0a665c918ba949bdca6372">Scene</a> super method! </p>
</blockquote>
<p>In addition to the events inherited from EventHandler, the Scene class also has all the following inheritable events:</p>
<ul>
<li><a class="el" href="class_kale_1_1_scene.html#a08db8e7b4435d601097a73386ad7daf7">void onPresent();</a> - Called when the scene is presented, guaranteed to be called from the main thread</li>
<li><a class="el" href="class_kale_1_1_scene.html#a30330cf17b0a7db9c435e9a9bd7a18de">void onSceneChange();</a> - Called prior to the scene being changed, guaranteed to be called from the main thread</li>
<li><a class="el" href="class_kale_1_1_scene.html#adf7f1c5309f921c648f6f258195a0e2f">void onUpdate(size_t threadNum, float deltaTime);</a> - Called on every frame update, called on every thread</li>
<li><a class="el" href="class_kale_1_1_scene.html#ad3a12a2df32e1e56d9fd16907213fcec">void onPreUpdate(size_t threadNum, float deltaTime);</a> - Called on every frame prior to the update, called on every thread</li>
</ul>
<p >If you need to run some code every frame which isn't applicable to a node directly, you need to add an if statement to check for a specific thread to avoid any update code from being called on multiple threads at the same time. You also need to ensure that your threadNum is in the range of the target hardware supported number of threads if you hardcode this.</p>
<h1><a class="anchor" id="scenesetup_s3"></a>
Node System &amp; Thread Scheduling</h1>
<p >There are different types of nodes, each detailed more in the <a class="el" href="md_src__kale__docs__tutorials.html#tutorials">Tutorials &amp; Guides</a> page. All nodes inherit from the <a class="el" href="class_kale_1_1_node.html">Node</a> class. To add a node, you need to pass a shared pointer of the node to <a class="el" href="class_kale_1_1_scene.html#a7b574c53033a942d2502bfcd84a797f3">addNode</a>. The method is templated and will work with any type inherited from the node class.</p>
<p ><a class="el" href="namespace_kale.html">Kale</a> uses a thread pool for updates. The number of threads in the pool is equivelant to <code>std::thread::hardware_concurrency()</code> (basically the number of threads supported on the device). Since there is a variable amount of threads, there is a node scheduling algorithm used to determine which thread a node is updated and pre updated on. Generally speaking, the timeframe for every render frame looks like the below:</p>
<div class="fragment"><div class="line">All update threads Pre Update Nodes</div>
<div class="line">** Wait for all threads to finish **</div>
<div class="line">All update threads Update Nodes</div>
<div class="line">** Wait for all threads to finish **</div>
<div class="line">Nodes which need to be added/removed are updated.</div>
<div class="line">Main thread renders, all update threads wait for rendering to finish</div>
<div class="line">Main thread waits for next frame&#39;s update threads.</div>
</div><!-- fragment --><p >Each node has an <a class="el" href="class_kale_1_1_node.html#a1428bedee3e0dcf9f2eb2c92129d29ce">updateTime</a> and <a class="el" href="class_kale_1_1_node.html#adc9bfb90371aa88d21ddea6cb6a52006">preUpdateTime</a> used for assigning nodes to threads. This means that a node can be pre updated in a different thread than it is updated in. Nodes have the following events:</p>
<ul>
<li><a class="el" href="class_kale_1_1_node.html#ae16cbae591a2d6bac3aa0ff11c556ba1">void begin(const Scene&amp; scene)</a> - Called when the node is added to the scene, gauranteed to be called from the main thread</li>
<li><a class="el" href="class_kale_1_1_node.html#ae26ecd36aad86bdf5fcc7738449415c7">void end(const Scene&amp; scene)</a> - Called when the node is removed from the scene, gauranteed to be called from the main thread</li>
<li><a class="el" href="class_kale_1_1_node.html#a2484cf082877f0ef92b79f9d9e966300">void render(const Camera&amp; camera, float deltaTime) const</a> - Called when the node must be rendered to the display, guaranteed to be called from the main thread</li>
<li><a class="el" href="class_kale_1_1_node.html#a1bfafc74c3464349faa81a8b19b0a216">void preUpdate(size_t threadNum, const Scene&amp; scene, float deltaTime)</a> - Called prior to updates. An excellent place to update properties of the node without reading from any other nodes</li>
<li><a class="el" href="class_kale_1_1_node.html#a476cd0ae53f6d266dcafc3fccfdd45d6">void update(size_t threadNum, const Scene&amp; scene, float deltaTime)</a> - Called after pre-updates. An excellent place to update the node if reading of other nodes is required.</li>
</ul>
<p >There are times when you may need to run some code on the main thread after updating but before rendering. <a class="el" href="namespace_kale.html">Kale</a> has a task system which you can use for this. Simply pass a function to <a class="el" href="class_kale_1_1_application.html#a402a90ec738005fb27a1dba00a5a9b5a">mainApp-&gt;runTaskOnMainThread(fn);</a>. Be careful when doing this however, if your function is a lambda which captures by reference or your function references any local variables, you'll want to ensure the variables you're referencing will be alive when the function is called. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 4 2022 20:34:50 for Kale by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
